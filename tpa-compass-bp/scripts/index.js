import{world as r,Player as m,system as i,TicksPerSecond as c}from"@minecraft/server";import{ActionFormData as l,MessageFormData as d}from"@minecraft/server-ui";r.afterEvents.itemUse.subscribe(({source:e,itemStack:t})=>{if(!(!(e instanceof m)||t.typeId!=="minecraft:compass")){if(e.isSneaking){e.hasTag("prevent")?(e.removeTag("prevent"),e.onScreenDisplay.setActionBar({translate:"tpa:toggle.off"})):(e.addTag("prevent"),e.onScreenDisplay.setActionBar({translate:"tpa:toggle.on"}));return}if(e.hasTag("cooldown")){e.onScreenDisplay.setActionBar({translate:"tpa:ask.cooldown"});return}f(e)}});r.afterEvents.playerSpawn.subscribe(({player:e,initialSpawn:t})=>{t&&i.run(()=>{e.hasTag("asked")&&e.removeTag("asked"),e.hasTag("cooldown")&&e.removeTag("cooldown")})});function f(e){let t=new l().title("tpa:players.list_title").body({translate:"tpa:players.list_body"}),n=r.getAllPlayers();if(n.length<=1){e.sendMessage({translate:"tpa:no_players"});return}let a=n.filter(s=>s.name!==e.nameTag);for(let s of a)t.button(s.name,"textures/ui/players");t.show(e).then(s=>{if(s.canceled||!s.selection)return;let o=n[s.selection];if(o){if(o.hasTag("asked"))return e.sendMessage({translate:"tpa:asked",with:[o.name]});if(o.hasTag("prevent"))return e.sendMessage({translate:"tpa:prevent",with:[o.name]});g(e,o)}else e.sendMessage({translate:"tpa:not_found"})})}function g(e,t){new l().title(t.nameTag).body("").button({translate:"tpa:tpa"}).button({translate:"tpa:tpa_here"}).button({translate:"tpa:back"}).show(e).then(a=>{if(!(a.selection===void 0||a.canceled))switch(a.selection){case 0:T(t,e);break;case 1:u(t,e);break;case 2:f(e);break}})}async function T(e,t){let n=new d().body({translate:"tpa:ask.body",with:[t.name]}).button1({translate:"tpa:ask.accept"}).button2({translate:"tpa:ask.reject"});e.addTag("asked");let a=await n.show(e);a.canceled||a.selection===void 0||(a.selection===0?(e.sendMessage({translate:"tpa:accept_player",with:[t.name]}),t.sendMessage({translate:"tpa:accept_target",with:[e.name]}),t?t.teleport(e.location,{dimension:e.dimension}):e.sendMessage({translate:"tpa:not_found"}),e.removeTag("asked"),t.addTag("cooldown"),i.runTimeout(()=>{if(e?.hasTag("cooldown"))return e.removeTag("cooldown")},c*20)):t.sendMessage({translate:"tpa:reject",with:[e.nameTag]}))}async function u(e,t){let n=new d().body({translate:"tpa:ask_here_body",with:[e.name]}).button1({translate:"tpa:ask.accept"}).button2({translate:"tpa:ask.reject"});t.addTag("asked");let a=await n.show(t);a.canceled||a.selection===void 0||(a.selection===0?(t.sendMessage({translate:"tpa:accept_player",with:[e.name]}),e.sendMessage({translate:"tpa:accept_target",with:[t.name]}),e?t.teleport(e.location,{dimension:e.dimension}):t.sendMessage({translate:"tpa:not_found"}),t.removeTag("asked"),e.addTag("cooldown"),i.runTimeout(()=>{if(t?.hasTag("cooldown"))return t.removeTag("cooldown")},c*20)):e.sendMessage({translate:"tpa:reject",with:[t.nameTag]}))}
